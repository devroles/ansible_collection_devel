language: python
python:
  - "2.7"
  - "3.8"
cache: pip
services:
  - docker

install:
  - pip install -U pip
  - pip --version
  - pip install tox tox-ansible
before_script:
  # Update submodules - like this one to get the latest
  - git submodule update --remote --recursive
  - cd ..
  # ansible collections need to be in an ansible_collection path
  - mkdir -p "ansible_collections/${COLLECTION_NAMESPACE}"
  - mv "$(basename "${TRAVIS_REPO_SLUG}")" "ansible_collections/${COLLECTION_NAMESPACE}/${COLLECTION_NAME}"
  - cd "ansible_collections/${COLLECTION_NAMESPACE}/${COLLECTION_NAME}"
script:
  - tox

env:
  global:
    - COLLECTION_NAMESPACE=devroles
    - COLLECTION_NAME=devel
    - TOX_ANSIBLE_DRIVER=docker
  jobs:
    - TOX_ANSIBLE_ROLE=ansible
    - TOX_ANSIBLE_ROLE=cinch
    - TOX_ANSIBLE_ROLE=mingw_sword_package
    - TOX_ANSIBLE_ROLE=sword

deploy:
  provider: releases
  api_key:
    secure: tIRIFH0m6pod/wOAvErJ4H9ZAEwMci+z0lwyedVqJ+Daf7Er8Yzs8zZK68lfz7vjCEVKNTS5JHCfb5VbKRiveyl7wB+ah9fDvVdKu6NCVNPe8gTLPR9nKTVCUgpDec+Isla7FKKjPA9U9wPx6buS2RfWdVQWagVKUL0nfaITk4HsTqXXmVEMxB2qCRN/upaSapl8QFqSKHXTosAKs6od/JdxerQM1uhYvxGVcyOa7zWdiKyNFnsSH1a5ynVPFGjDDbxhV2RJOx/jyQxkmjPcaywCVnfmVNrVbsMabesd8FqLPwdS/xcMBGyyb3sZN6xeWCTLpIXQiYok2eAh7p6mMSKJUvAw8j15sPVo6r3lQMqP5HwMJ5j+vdwjy5cB40R0Hg7tsq9V1gveJyT458bkLzDklTWOzoAJsJpX9Z2jRz6+rGg3h//Ljx9boEC/M+LCzECyRIU6FVi6jaIbiAZ3mUtHZRoBQZPb91ZXYEgpCXlb145Kg7+cUA6bM4RdIjrsjBI/v5bkmIFDmTuEip8KbYljB5/rMVQjawWDX0YJISBqE9tvxvbLTeqDZsBf2uC4HRX+Im6PHmhEBQW6G7wEumVlSGkpTSdK4US+p45lANp1D1DYGhp7WIbpSImUWtWJaKgVFMNPXux4EoFE2OAhqHYgmDqTh3Z8/rBSlTf4mIc=
  file_glob: true
  file: "roles/mingw_sword_package/*.zip"
  skip_cleanup: true
  "on":
    repo: devroles/ansible_collection_devel
    tags: true
    condition: ${TOX_ANSIBLE_ROLE} = "mingw_sword_package"
    python: "3.8"
