language: python
python:
  - "2.7"
  - "3.8"
cache: pip
services:
  - docker

install:
  - pip install -U pip
  - pip --version
  - pip install tox tox-ansible
before_script:
  # Update submodules - like this one to get the latest
  - git submodule update --remote --recursive
  - cd ..
  # ansible collections need to be in an ansible_collection path
  - mkdir -p "ansible_collections/${COLLECTION_NAMESPACE}"
  - mv "$(basename "${TRAVIS_REPO_SLUG}")" "ansible_collections/${COLLECTION_NAMESPACE}/${COLLECTION_NAME}"
  - cd "ansible_collections/${COLLECTION_NAMESPACE}/${COLLECTION_NAME}"
script:
  - tox

env:
  global:
    - COLLECTION_NAMESPACE=devroles
    - COLLECTION_NAME=devel
    - TOX_ANSIBLE_DRIVER=docker
  jobs:
    - TOX_ANSIBLE_ROLE=ansible
    - TOX_ANSIBLE_ROLE=cinch
    - TOX_ANSIBLE_ROLE=mingw_sword_package
    - TOX_ANSIBLE_ROLE=sword

deploy:
  provider: releases
  api_key:
    secure: kWvSkPAM1jyJq8PeRNymtvNWoJ2okcsxHE+UOv/i1fpcMffynkr/9QbcCtO0ylDAjn7esYaX6XyKH7eDT0Ym/Ag0GYMA1RyAR0uuu/APoK7nF3S0TreSgETcvzyuKlu3UbSr87kyAVLwAdnf+zocEjOPkzTGYAUyN5NQuUijEo+OWzaCGKuKe65zIVvU6OEnW4sxDBHGz0lAxxDdGM2V+WlfOtju06wX7XZzDGyI4jmUnSl+w4KcpHjZ2+GzQJVXiWPToDEGtSw5Q0wQUIAHrRJnc0subhYci33oMhxG8fh4WlT17uvOFt0gvKtgAPIUxNTsgcqiFwWgsRYFj6QYeF5plWi7vuEbY7d/bv54tCDPZaHKA7fXr2N4+LgL5t5p06bBqq3a8wLPZDKRS9Egq38vQmqrw0R6NYfIFaE5FU+ISgZcFZCOnp+4S6ZEpVeZtiJ9HY4nHqllUZDLOLtOMkUHUO0rScRAOOhtYPcPO137DKUwZbP05oG773123bBz9UKVFXcbYmDXGFfuarDEWJ2hTgPwJLPAz0cnXkw4JvD3H0djWCbPIqiJfGzh9PnwioOmxrakwHLyCOIVyzFSH6Swg1XXhnNf4aZoscE0llhBIFePmZBst20mIIBElPS86RVmtT36+HuXHDOScz9CIvhj/5NmCBXurEvUbcwoU5A=
  file_glob: true
  file: "roles/mingw_sword_package/*.zip"
  skip_cleanup: true
  "on":
    repo: devroles/ansible_collection_devel
    tags: true
    condition: ${TOX_ANSIBLE_ROLE} = "mingw_sword_package"
    python: "3.8"
